<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<title th:text="#{commerce.screen.item.search}">Item Lookup Page</title>
<!-- This thymeleaf fragment include all the header stuff -->
<div th:replace="common/header:: header"></div>

<div th:fragment="itemlookup-scripts">
	<script type="text/javascript">
		$(function() {
			/*  Submit form using Ajax */
			$('#searchBtn').click(function(e) {

				//Prevent default submission of form
				e.preventDefault();

				resubmitLookup();
			});
		});

		function resubmitLookup(pageNo) {
			if (arguments.length > 0) {
				$('#page').val(pageNo);
				var formdata = $('form[id=searchForm]').serialize();
				$.post({
					url : '/item_lookup',
					data : formdata,
					success : function(res) {
						processResponse(res);
					}
				});
			} else {
				$.post({
					url : '/item_lookup',
					data : $('form[id=searchForm]').serialize(),
					success : function(res) {
						processResponse(res);
					}
				});
			}
		}

		function processResponse(res) {
			//Set response
			var result = res.items;
			var pager = res.pager;
			var output = '<table class="table table-striped table-hover table-bordered"><thead class="thead-light"><tr><th>#</th><th>Item Id</th><th> Name</th><th>Description</th></tr></thead><tbody>';
			for ( var i in result) {
				output += '<tr><td><input type="radio" name="rditemId" value="'+result[i].itemId+'"></input></td><td>'
						+ result[i].itemId
						+ "</td><td>"
						+ result[i].name
						+ "</td><td>" + result[i].longDesc + "</td></tr>";
			}
			output += "</tbody></table>";

			output += createPagination(pager.displayPages, pager);

			$('#response').html(output);

		}

		function createPagination(displayPages, pager) {
			var output = "";
			output += '<nav aria-label="Pagination" > <ul class="pagination pagination-sm justify-content-end">';
			output += '<li class="page-item"><a class="page-link" href="#" tabindex="-1" onclick="resubmitLookup(1);"><span th:text="#{commerce.screen.common.pagination.first}">First</span></a></li>';
			for ( var p in displayPages) {
				output += '<li class="page-item"><a class="page-link" href="#" onclick="resubmitLookup('
						+ displayPages[p]
						+ ');">'
						+ displayPages[p]
						+ '</a></li>';
			}
			output += '<li class="page-item"><a class="page-link" href="#" onclick="resubmitLookup('
					+ pager.lastPageNo
					+ ');"><span th:text="#{commerce.screen.common.pagination.last}">Last</span></a></li>';
			output += '</ul></nav>';
			return output;
		}
	</script>
</div>
</head>
<body>

	<div id="wrapper">

		<!-- This thymeleaf fragment include left menu -->
		<div th:include="common/menu:: leftMenu"></div>

		<!-- Page Content -->
		<div id="page-content-wrapper">

			<!-- This thymeleaf fragment include the top navigation bar-->
			<div th:include="common/navbar :: navbarMenu"></div>



			<!-- This thymeleaf fragment is the body part for the page-->
			<div th:fragment="itemlookup-screen">
				<div class="card content-container">
					<div class="card-body">
						<div class="card-text">
							<form class="form" id="searchForm" action="#"
								th:action="@{/item_lookup}" th:object="${searchBean}"
								method="post">
								<div class="row">
									<div class="col-12">
										<div class="form-group text-left">
											<div class="input-group">
												<input type="hidden" th:field="*{page}"></input> <input
													type="text" th:field="*{searchText}"
													class="input-control input-sm"
													th:placeholder="#{commerce.screen.item.search.text}"
													placeholder="Enter keyword to search"
													aria-describedby="searchHelp"></input>
												<div class="input-group-append">
													<input type="submit" id="searchBtn" value="Search"
														th:value="#{commerce.screen.btn.search}"
														class="form-control btn btn-info btn-sm"></input>
												</div>
											</div>

											<small id="searchHelp" class="form-text text-muted"
												th:text="#{commerce.screen.item.search.keywords}">Enter
												keywords like Item#/Style#/Name/Description</small>
											<div th:if="${#fields.hasErrors('searchText')}"
												th:errors="*{searchText}" class="text-danger">Search
												Text Error</div>
										</div>
									</div>
								</div>
							</form>
						</div>
						<div class="card-text">
							<div id="response"></div>
							<div th:if="${ success!=null}" th:text="${success}"
								class="alert alert-success " role="alert"></div>
							<div th:if="${ alert!=null}" th:text="${alert}"
								class="alert alert-danger " role="alert"></div>

							<div
								th:if="${items!=null and items.items!=null and #lists.size(items.items)&gt;0}">

								<form class="form" id="selectForm" action="#"
									th:action="@{/item_lookup}" th:object="${items}" method="post">

									<div class="row">
										<div class="col-12 text-right">
											<nav aria-label="Pagination" th:if="${pager!=null}">
												<ul class="pagination pagination-sm justify-content-end">
													<li
														th:class="${pager.firstPage} ? 'page-item disabled': 'page-item'"><a
														class="page-link" href="#" tabindex="-1"
														th:onclick="'searchResults(\'/item_lookup?page=1\')'">First</a></li>

													<th:block th:each="page,itrStat:${pager.displayPages}">
														<li
															th:class="${pager.currentPageNo == page} ? 'page-item active': 'page-item'"><a
															class="page-link" href="#"
															th:onclick="'searchResults(\'/item_lookup?page='+${page}+'\')'"><span
																th:text="${page}"></span></a></li>
													</th:block>


													<li
														th:class="${pager.lastPage} ? 'page-item disabled': 'page-item'"><a
														class="page-link" href="#"
														th:onclick="'searchResults(\'/item_lookup?page='+${pager.lastPageNo}+'\')'">Last</a></li>

												</ul>
											</nav>
										</div>
									</div>

									<table class="table table-striped table-hover table-bordered">
										<thead class="thead-light">
											<tr>
												<th scope="col" th:text="#{commerce.screen.item.id}">Select</th>
												<th scope="col" th:text="#{commerce.screen.item.name}">Item
													#</th>
												<th scope="col" th:text="#{commerce.screen.item.name}">Item
													Name</th>
												<th scope="col"
													th:text="#{commerce.screen.item.description}">Description</th>
											</tr>
										</thead>
										<tbody>
											<th:block th:each="item,itrStat:${items.items}">
												<tr>
													<td class="input-group"><input type="radio"
														class="form-control input-sm itemId" th:field="*{itemIds}"
														th:value="${items.items[__${itrStat.index}__].itemId}+'_'+${itrStat.index}"></input>
													</td>
													<td><span
														th:text="${items.items[__${itrStat.index}__].itemId}"></span>
													</td>
													<td><span
														th:text="${items.items[__${itrStat.index}__].name}"></span></td>
													<td><span
														th:text="${items.items[__${itrStat.index}__].longDesc}"></span>
													</td>

												</tr>
											</th:block>

										</tbody>
									</table>
									<div class="row">
										<div class="col-4"></div>
										<div class="col-8 text-right">
											<nav aria-label="Pagination" th:if="${pager!=null}">
												<ul class="pagination pagination-sm justify-content-end">
													<li
														th:class="${pager.firstPage} ? 'page-item disabled': 'page-item'"><a
														class="page-link" href="#" tabindex="-1"
														th:onclick="'searchResults(\'/item_lookup?page=1\')'">First</a></li>

													<th:block th:each="page,itrStat:${pager.displayPages}">
														<li
															th:class="${pager.currentPageNo == page} ? 'page-item active': 'page-item'"><a
															class="page-link" href="#"
															th:onclick="'searchResults(\'/item_lookup?page='+${page}+'\')'"><span
																th:text="${page}"></span></a></li>
													</th:block>


													<li
														th:class="${pager.lastPage} ? 'page-item disabled': 'page-item'"><a
														class="page-link" href="#"
														th:onclick="'searchResults(\'/item_lookup?page='+${pager.lastPageNo}+'\')'">Last</a></li>

												</ul>
											</nav>
										</div>
									</div>

									<div class="row">
										<div class="col-12">
											<div class="form-group">
												<button type="button" class="btn btn-secondary"
													data-dismiss="modal" value="Close"
													th:value="#{commerce.btn.close}">Close</button>
												<button type="button" id="itemChooseBtn" class="btn btn-primary"
													value="Choose This Item"
													th:value="#{commerce.btn.choose.item}">Choose This
													Item</button>
											</div>
										</div>

									</div>
								</form>
							</div>


						</div>
					</div>

				</div>

			</div>

		</div>
		<!-- /#page-content-wrapper -->

	</div>
	<!-- /#wrapper -->


</body>
</html>