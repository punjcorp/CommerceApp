<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
<meta th:name="_csrf" th:content="${_csrf.token}" />
<meta th:name="_csrf_header" th:content="${_csrf.headerName}" />
<meta charset="utf-8" />
<title th:text="#{commerce.screen.order.add.title}"></title>
<!-- This thymeleaf fragment include all the header stuff -->
<div th:replace="common/header:: header"></div>
<script src="../../js/jquery-ui.min.js" th:src="@{/js/jquery-ui.min.js}"></script>
<script src="../../js/parsley.min.js" th:src="@{/js/parsley.min.js}"></script>
<script src="../../js/moment.js" th:src="@{/js/moment.js}"></script>
<script src="../../js/order/order_classes.js" th:src="@{/js/order/order_classes.js}"></script>
<script src="../../js/order/order.js" th:src="@{/js/order/order.js}"></script>
</head>
<body>
	<div id="wrapper">
		<!-- This thymeleaf fragment include left menu -->
		<div th:include="common/menu:: leftMenu"></div>
		<!-- Page Content -->
		<div id="page-content-wrapper">
			<!-- This thymeleaf fragment include the top navigation bar-->
			<div th:include="common/navbar :: navbarMenu"></div>
			<!-- This thymeleaf fragment is the body part for the page-->
			<form class="form" id="addForm" action="#" th:action="@{/admin/add_order}" th:object="${orderBeanDTO}" method="post">
				<div class="row">
					<div class="col">
						<div class="card">
							<div class="card-header">
								<h3 th:text="#{commerce.screen.order.add}">Create Purchase Order</h3>
							</div>
							<div class="card-body">
								<div class="card-text">
									<div th:if="${ success!=null}" th:text="${success}" class="alert alert-success " role="alert"></div>
									<div th:if="${ alert!=null}" th:text="${alert}" class="alert alert-danger " role="alert"></div>
									<div class="row">
										<div class="col-6">
											<div class="form-group text-left">
												<div class="input-group">
													<input type="hidden" th:field="*{order.supplierId}"></input> <input type="text" th:field="*{supplierSearch.searchText}"
														class="form-control input-sm" th:placeholder="#{commerce.screen.supplier.search.text}" placeholder="Enter keyword to search"
														aria-describedby="searchHelp"></input>
												</div>
												<small id="searchHelp" class="form-text text-muted" th:text="#{commerce.screen.supplier.search.keywords}">Enter keywords like
													id/Name/Email/Address/Phone#</small>
												<div th:if="${#fields.hasErrors('supplierSearch.searchText')}" th:errors="*{supplierSearch.searchText}" class="text-danger">Search
													Text Error</div>
											</div>
										</div>
										<div class="col-6">
											<div class="form-group text-left">
												<div class="input-group">
													<input type="text" th:field="*{order.locationId}" class="form-control input-sm " th:placeholder="#{commerce.screen.order.location}"
														maxlength="80"></input>
													<div th:if="${#fields.hasErrors('order.locationId')}" th:errors="*{order.locationId}" class="text-danger">Location Error</div>
												</div>
											</div>
										</div>
									</div>
									<div class="orderitem">
										<th:block th:each="orderItem,itrStat:${orderBeanDTO.order.orderItems}">
											<div class="form-group">
												<div class="row">
													<div class="col-3">
														<div class="form-group text-left">
															<div class="input-group">
																<input type="text" th:field="${orderBeanDTO.order.orderItems[__${itrStat.index}__].itemId}" class="form-control input-sm"
																	th:placeholder="#{commerce.screen.order.item}" maxlength="150"></input>
															</div>
															<small id="searchHelp" class="form-text text-muted" th:text="#{commerce.screen.item.search.keywords}">Enter keywords like
																Item#/Name/Description</small>
															<div th:if="${#fields.hasErrors('order.orderItems[__${itrStat.index}__].itemId')}"
																th:errors="${orderBeanDTO.order.orderItems[__${itrStat.index}__].itemId}" class="text-danger">Item Id Error</div>
														</div>
													</div>
													<div class="col padding-sm">
														<div class="form-group">
															<input type="text" th:field="${orderBeanDTO.order.orderItems[__${itrStat.index}__].orderedQty}" class="form-control input-sm"
																th:placeholder="#{commerce.screen.order.qty}" maxlength="150"></input>
															<div th:if="${#fields.hasErrors('order.orderItems[__${itrStat.index}__].orderedQty')}"
																th:errors="${orderBeanDTO.order.orderItems[__${itrStat.index}__].orderedQty}" class="text-danger">Quantity Error</div>
														</div>
													</div>
													<div class="col padding-sm">
														<div class="form-group">
															<input type="text" th:field="${orderBeanDTO.order.orderItems[__${itrStat.index}__].costAmount}" class="form-control input-sm"
																th:placeholder="#{commerce.screen.order.cost}" maxlength="150"></input>
															<div th:if="${#fields.hasErrors('order.orderItems[__${itrStat.index}__].costAmount')}"
																th:errors="${orderBeanDTO.order.orderItems[__${itrStat.index}__].costAmount}" class="text-danger">Unit Cost Error</div>
														</div>
													</div>
													<div class="col padding-sm">
														<div class="form-group">
															<input type="text" th:field="${orderBeanDTO.order.orderItems[__${itrStat.index}__].totalCost}" class="form-control input-sm"
																th:placeholder="#{commerce.screen.order.total.cost}" maxlength="150"></input>
															<div th:if="${#fields.hasErrors('order.orderItems[__${itrStat.index}__].totalCost')}"
																th:errors="${orderBeanDTO.order.orderItems[__${itrStat.index}__].totalCost}" class="text-danger">Total Cost Error</div>
														</div>
													</div>
													<div class="col padding-sm">
														<div class="form-group">
															<input type="text" th:field="${orderBeanDTO.order.orderItems[__${itrStat.index}__].taxAmount}" class="form-control input-sm"
																th:placeholder="#{commerce.screen.order.amount.item.total.tax}" maxlength="150"></input>
															<div th:if="${#fields.hasErrors('order.orderItems[__${itrStat.index}__].taxAmount')}"
																th:errors="${orderBeanDTO.order.orderItems[__${itrStat.index}__].taxAmount}" class="text-danger">Item Tax Total Error</div>
														</div>
													</div>
													<div class="col padding-sm">
														<div class="form-group">
															<input type="text" th:field="${orderBeanDTO.order.orderItems[__${itrStat.index}__].totalActualAmount}" class="form-control input-sm"
																th:placeholder="#{commerce.screen.order.amount.item.total}" maxlength="150"></input>
															<div th:if="${#fields.hasErrors('order.orderItems[__${itrStat.index}__].totalActualAmount')}"
																th:errors="${orderBeanDTO.order.orderItems[__${itrStat.index}__].totalActualAmount}" class="text-danger">Item Total Amount Error</div>
														</div>
													</div>
													<div class="col padding-sm">
														<div class="form-group">
															<button type="submit" name="addOrderItem" class="btn btn-secondary btn-sm">
																<i class="far fa-plus-square fa-2x"></i>
															</button>
															<button type="button" th:if="${#lists.size(orderBeanDTO.order.orderItems)>1}"
																th:onclick="'deleteItem(\'/admin/add_order?removeOrderItem=&amp;id='+ ${itrStat.index} +'\')'" class="btn btn-secondary btn-sm">
																<i class="far fa-minus-square fa-2x"></i>
															</button>
														</div>
													</div>
												</div>
											</div>
										</th:block>
									</div>
									<div class="row">
										<div class="col-xs-6 col-sm-6 col-md-6"></div>
										<div class="col-xs-3 col-sm-3 col-md-3 text-right">
											<span th:text="#{commerce.screen.btn.order.estimated.total.cost}">Total Estimated Cost</span>
										</div>
										<div class="col-xs-3 col-sm-3 col-md-3">
											<div id="totalOrderCost">
												INR <span th:text="${orderBeanDTO.order.estimatedCost}">0.0</span>
											</div>
											<input type="hidden" th:field="*{order.estimatedCost}"></input>
										</div>
									</div>
									<div class="row">
										<div class="col-xs-2 col-sm-2 col-md-2">
											<div class="form-group">
												<input type="submit" name="saveOrder" value="Save" th:value="#{commerce.screen.btn.submit.save}" class="btn btn-info"></input>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-4">
						<div id="supplierDetails" th:class="${orderBeanDTO.order.supplier.supplierId==null}?'d-none':''">
							<div class="card border-box-filled">
								<input type="hidden" th:field="*{order.supplier.supplierId}"></input> <input type="hidden" th:field="*{order.supplier.name}"></input> <input
									type="hidden" th:field="*{order.supplier.phone1}"></input> <input type="hidden" th:field="*{order.supplier.phone2}"></input> <input
									type="hidden" th:field="*{order.supplier.email}"></input> <input type="hidden" th:field="*{order.supplier.primaryAddress.addressId}"></input>
								<input type="hidden" th:field="*{order.supplier.primaryAddress.addressType}"></input> <input type="hidden"
									th:field="*{order.supplier.primaryAddress.primary}"></input> <input type="hidden" th:field="*{order.supplier.primaryAddress.address1}"></input>
								<input type="hidden" th:field="*{order.supplier.primaryAddress.address2}"></input> <input type="hidden"
									th:field="*{order.supplier.primaryAddress.city}"></input> <input type="hidden" th:field="*{order.supplier.primaryAddress.state}"></input> <input
									type="hidden" th:field="*{order.supplier.primaryAddress.country}"></input> <input type="hidden"
									th:field="*{order.supplier.primaryAddress.pincode}"></input>
								<div class="card-body">
									<div class="row">
										<div class="col-4">
											<div class="card-text">
												<h4>
													<span th:text="#{commerce.screen.order.supplier.address}"></span>
												</h4>
											</div>
											<div class="card-text my-3">
												<div class="fa-3x">
													<span class="fa-layers fa-fw"> <i class="fas fa-map-marker"></i> <i class="fas fa-circle color-blue"
														data-fa-transform="shrink-10 up-2"></i></span>
												</div>
											</div>
										</div>
										<div class="col-8">
											<div class="row">
												<div class="col-2">
													<i class="fas fa-address-card"></i>
												</div>
												<div class="col text-left">
													<div class="card-text">
														<small><span id="primaryAddress1" th:text="${orderBeanDTO.order.supplier.primaryAddress.address1}"></span></small>
													</div>
												</div>
											</div>
											<div class="row" th:if="${orderBeanDTO.order.supplier.primaryAddress.address2!=null}">
												<div class="col-2"></div>
												<div class="col text-left">
													<div class="card-text">
														<small><span id="primaryAddress2" th:text="${orderBeanDTO.order.supplier.primaryAddress.address2}"></span></small>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-2"></div>
												<div class="col text-left">
													<div class="card-text">
														<small><span id="primaryCity" th:text="${orderBeanDTO.order.supplier.primaryAddress.city}"></span>, <span
															th:text="${orderBeanDTO.order.supplier.primaryAddress.state}"></span></small>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-2"></div>
												<div class="col text-left">
													<div class="card-text">
														<small><span id="primaryCountry" th:text="${orderBeanDTO.order.supplier.primaryAddress.country}"></span>, <span
															th:text="${orderBeanDTO.order.supplier.primaryAddress.pincode}"></span></small>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-2">
													<i class="fas fa-phone" data-fa-transform="flip-h"></i>
												</div>
												<div class="col text-left">
													<div class="card-text">
														<small><span id="supplierPhone" th:text="${orderBeanDTO.order.supplier.phone1}"></span></small>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-2">
													<i class="fas fa-envelope"></i>
												</div>
												<div class="col text-left">
													<div class="card-text">
														<small><span id="supplierEmail" th:text="${orderBeanDTO.order.supplier.email}"></span></small>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div id="orderTotals"></div>
					</div>
				</div>
			</form>
		</div>
		<!-- /#page-content-wrapper -->
	</div>
	<!-- /#wrapper -->
	<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/

		var totalRecords = '';

		/*]]>*/
	</script>
</body>
</html>